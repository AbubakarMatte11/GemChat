<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GemChat - Diagnostic Mode</title>
    <link rel="icon" type="image/png" href="../assets/images/gemchat.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/chat.css">

    <script type="importmap">
      {
        "imports": {
          "firebase/app": "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js",
          "firebase/auth": "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js",
          "firebase/storage": "https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js"
        }
      }
    </script>
    
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

    <script>
      if (typeof io === 'undefined') {
        // If 'io' is still not defined, it proves the script is being blocked.
        alert("CRITICAL ERROR: The Socket.IO library failed to load. This is likely caused by a browser extension (like an ad blocker) or a network firewall. Please check your extensions and try a different browser or network.");
        throw new Error("Socket.IO library is blocked or failed to load.");
      } else {
        // If 'io' is defined, we can proceed.
        console.log("%cSUCCESS: Socket.IO library loaded correctly. 'io' is defined.", "color: green; font-weight: bold; font-size: 1.2em;");
      }
    </script>

</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <header class="sidebar-header">
                <div class="sidebar-user-info">
                    <a href="profile.html"><img id="my-profile-avatar" src="../assets/images/user-avatar.png" alt="My Profile" class="profile-avatar"></a>
                    <span id="current-user-name" class="current-user-name">Loading...</span>
                </div>
                <div class="sidebar-header-actions">
                    <div class="theme-switch-wrapper">
                        <label class="theme-switch" for="theme-checkbox">
                            <input type="checkbox" id="theme-checkbox" />
                            <div class="slider round"></div>
                        </label>
                    </div>
                </div>
            </header>
            <div class="search-bar"><input type="text" id="search-input" placeholder="Search or start new chat"></div>
            <div id="contact-list" class="contact-list"></div>
        </div>
        <main class="chat-window">
            <div id="welcome-screen" class="welcome-screen">
                <img src="../assets/images/gemchat.png" alt="GemChat Logo" style="width: 150px;">
                <h2>Welcome to GemChat!</h2>
                <p>Your secure, AI-powered messaging app.</p>
                <ul class="feature-list">
                    <li>üí¨ Real-Time 1-to-1 Chat</li>
                    <li>ü§ñ Buddy AI Assistant (@buddy)</li>
                    <li>üë• Contact List with Live Search</li>
                    <li>‚úîÔ∏è Message Status (Sent, Delivered, Read)</li>
                    <li>üü¢ Online/Offline Presence</li>
                    <li>üé® Light & Dark Mode Themes</li>
                </ul>
            </div>
            <div id="chat-content" class="chat-content hidden">
                <header class="chat-header">
                    <img id="chat-avatar" src="../assets/images/user-avatar.png" alt="User" class="profile-avatar">
                    <div class="chat-header-info">
                        <h3 id="chat-with-name"></h3>
                        <p id="chat-with-status">offline</p>
                    </div>
                    <div class="chat-header-actions"></div>
                </header>
                <div id="message-container" class="message-container"></div>
                <footer class="chat-input-area">
                    <input type="text" id="message-input" placeholder="Type a message or @buddy...">
                    <button id="send-button">‚û§</button>
                </footer>
            </div>
        </main>
    </div>

    <script src="../js/firebase-init.js" type="module"></script>
    <script src="../js/auth-manager.js" type="module"></script>
    <script src="../js/contacts.js" type="module"></script>
    <script src="../js/chat.js" type="module"></script>
    <script type="module">
        import { initializeAuthListener } from '../js/auth-manager.js';
        initializeAuthListener();
    </script>
</body>
</html>